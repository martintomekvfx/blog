---
import BaseLayout from "../layouts/BaseLayout.astro";

const buttondownUsername = import.meta.env.PUBLIC_BUTTONDOWN_USERNAME || "tomek";
const hasButtondown = Boolean(buttondownUsername);
const buttondownAction = `https://buttondown.com/api/emails/embed-subscribe/${buttondownUsername}`;
const buttondownLanding = `https://buttondown.com/${buttondownUsername}`;
const buttondownReferral = `https://buttondown.com/refer/${buttondownUsername}`;
---

<BaseLayout
  title="Newsletter | Martin Tomek"
  description="Subscribe to receive new Martin Tomek posts by email."
>
  <section class="max-w-2xl">
    <h1 class="text-3xl font-bold text-balance mb-2">Newsletter</h1>
    <p class="opacity-70 mb-8 text-pretty">
      New writing on art, VFX, tactical urbanism, and open tools â€” sent when there is
      something worth reading.
    </p>

    <form
      action={buttondownAction}
      method="post"
      class="embeddable-buttondown-form border border-black p-4 sm:p-6"
      referrerpolicy="unsafe-url"
    >
      <label for="bd-email" class="block text-xs uppercase tracking-[0.1em] mb-3">
        Enter your email
      </label>
      <div class="flex flex-col sm:flex-row gap-2">
        <input
          type="email"
          name="email"
          id="bd-email"
          required
          placeholder="you@example.com"
          class="flex-1 border border-black px-3 py-2 text-sm focus:outline-none"
        />
        <input
          type="submit"
          value="Subscribe"
          class="border border-black px-4 py-2 text-xs uppercase font-medium cursor-pointer hover:bg-black hover:text-white transition-colors duration-100"
        />
      </div>
      <p class="mt-3 text-xs opacity-50">
        <a href={buttondownReferral} target="_blank" rel="noopener noreferrer" class="underline underline-offset-4">
          Powered by Buttondown.
        </a>
      </p>
    </form>

    <details class="mt-6">
      <summary class="text-xs uppercase tracking-[0.1em] opacity-60 cursor-pointer select-none">Prefer an iframe embed?</summary>
      <div class="mt-3 border border-black overflow-hidden">
        <iframe
          scrolling="no"
          style="width:100%;height:220px;border:none;"
          src={`${buttondownLanding}?as_embed=true`}
        />
      </div>
    </details>

    <p class="text-sm opacity-70 mt-6">
      Prefer feeds/automation? RSS is still available at
      <a href="/blog/rss.xml" class="underline underline-offset-4">/blog/rss.xml</a>.
    </p>
  </section>
</BaseLayout>
